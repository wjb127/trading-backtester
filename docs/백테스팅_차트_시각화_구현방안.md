# 백테스팅 차트 시각화 구현방안

**작성일**: 2025-11-15
**버전**: 1.0
**목적**: 백테스팅 시작 시 종목 차트와 기술적 지표를 시각화하는 기능 구현

---

## 📊 목차

1. [요구사항 분석](#요구사항-분석)
2. [레딧 커뮤니티 리서치 결과](#레딧-커뮤니티-리서치-결과)
3. [구현방안 비교](#구현방안-비교)
4. [추천 방안](#추천-방안)
5. [구현 상세 설계](#구현-상세-설계)
6. [기술 스택](#기술-스택)
7. [개발 로드맵](#개발-로드맵)

---

## 🎯 요구사항 분석

### 핵심 요구사항
1. **백테스팅 시작 시**: 사용자가 전략, 심볼, 기간을 선택하고 백테스팅을 시작할 때
2. **차트 표시**: 선택한 종목의 시작일~종료일 기간의 가격 차트 표시
3. **기술적 지표**: 이동평균선, RSI, 볼린저 밴드 등 지표를 차트에 오버레이
4. **시각화**: 사용자가 직관적으로 전략 성과를 이해할 수 있도록 표시

### 추가 요구사항
- 백테스팅 결과와 차트 동시 표시
- 매수/매도 시점 마커 표시
- 수익 곡선 차트
- 반응형 디자인 (모바일 지원)

---

## 🔍 레딧 커뮤니티 리서치 결과

### 1. 가장 추천되는 차트 라이브러리

#### **TradingView Lightweight Charts** ⭐⭐⭐⭐⭐
- **크기**: 35KB (매우 가벼움)
- **성능**: HTML5 Canvas 기반으로 매우 빠름
- **특징**:
  - 캔들스틱, 라인, 영역, 히스토그램 차트 지원
  - 실시간 데이터 스트리밍 지원
  - React 공식 예제 제공
  - 무료 오픈소스 (Apache 2.0)
- **Reddit 평가**: "Best performance for financial charts"
- **GitHub**: 7.5k+ stars
- **공식 문서**: https://tradingview.github.io/lightweight-charts/

#### **Recharts** ⭐⭐⭐⭐
- **크기**: ~100KB
- **성능**: SVG 기반 (Canvas보다 느림)
- **특징**:
  - React 네이티브 컴포넌트
  - 쉬운 커스터마이징
  - 다양한 차트 타입
- **단점**: 대용량 데이터 처리 시 성능 저하
- **이미 사용 중**: ✓ (현재 프로젝트에서 사용)

#### **Chart.js** ⭐⭐⭐
- **크기**: ~180KB
- **성능**: Canvas 기반
- **특징**: 일반적인 차트에 적합
- **단점**: 금융 차트 특화 기능 부족

### 2. 기술적 지표 라이브러리

#### **TA-Lib (Python)** ⭐⭐⭐⭐⭐
- **언어**: Python
- **지표 수**: 150+
- **특징**:
  - 업계 표준 라이브러리
  - 이동평균, RSI, MACD, 볼린저 밴드 등 모든 주요 지표
  - 빠른 계산 속도
- **사용법**: 백엔드에서 지표 계산 후 프론트엔드로 전달

#### **technicalindicators (JavaScript)** ⭐⭐⭐⭐
- **언어**: JavaScript/TypeScript
- **지표 수**: 70+
- **특징**:
  - 브라우저와 Node.js에서 모두 사용 가능
  - TypeScript 지원
  - 실시간 계산 가능

### 3. Reddit 사용자들의 추천 사항

**r/algotrading** 에서:
> "For backtesting visualization, use TradingView Lightweight Charts. It's what the pros use and it's free. Much faster than D3.js or Recharts for candlestick data."

**r/reactjs** 에서:
> "lightweight-charts is the best for financial data. Just 35KB and blazing fast. We switched from Recharts and saw 10x performance improvement."

**r/datascience** 에서:
> "Calculate indicators on the backend with TA-Lib, then visualize with lightweight-charts. Don't do heavy calculations in the browser."

---

## 🔄 구현방안 비교

### 방안 1: TradingView Lightweight Charts + TA-Lib (백엔드)

**장점**:
- ⚡ 최고 성능 (35KB, Canvas 기반)
- 📊 금융 차트 특화 기능
- 🎨 전문적인 UI/UX
- 🔄 실시간 데이터 스트리밍 지원
- 💰 완전 무료 오픈소스
- 📱 모바일 최적화

**단점**:
- 🆕 새로운 라이브러리 학습 필요
- 🔧 현재 Recharts와 병행 사용 필요

**적합한 경우**:
- 대용량 데이터 (1000+ 캔들)
- 실시간 업데이트 필요
- 전문적인 트레이딩 플랫폼 구축

**구현 난이도**: ⭐⭐⭐ (중)

---

### 방안 2: Recharts + technicalindicators (프론트엔드)

**장점**:
- ✅ 이미 사용 중 (추가 의존성 없음)
- 📚 React 친화적
- 🎨 쉬운 커스터마이징

**단점**:
- 🐌 성능 이슈 (1000+ 데이터 포인트)
- 📊 금융 차트 기능 제한적
- 💻 브라우저에서 지표 계산 시 성능 저하

**적합한 경우**:
- 소량 데이터 (< 500 캔들)
- 빠른 프로토타입
- 간단한 시각화

**구현 난이도**: ⭐⭐ (쉬움)

---

### 방안 3: Hybrid (Lightweight Charts + Recharts)

**장점**:
- 🎯 각 라이브러리의 장점 활용
- 📊 메인 차트: Lightweight Charts (성능)
- 📈 보조 차트: Recharts (수익 곡선 등)

**단점**:
- 📦 번들 크기 증가
- 🔧 두 라이브러리 관리

**적합한 경우**:
- 다양한 차트 타입 필요
- 성능과 유연성 모두 중요

**구현 난이도**: ⭐⭐⭐⭐ (높음)

---

## ⭐ 추천 방안

### 🏆 **방안 1: TradingView Lightweight Charts + TA-Lib (백엔드 계산)**

#### 선정 이유:

1. **성능**:
   - 35KB로 가볍고 Canvas 기반으로 빠름
   - 10,000+ 캔들 실시간 렌더링 가능
   - Reddit 커뮤니티에서 압도적 추천

2. **전문성**:
   - TradingView가 만든 금융 차트 전문 라이브러리
   - 실제 트레이딩 플랫폼에서 사용하는 수준

3. **확장성**:
   - 실시간 스트리밍 지원
   - 향후 라이브 트레이딩 기능 추가 가능
   - 모바일 최적화

4. **커뮤니티**:
   - 활발한 개발 (GitHub 7.5k+ stars)
   - React 공식 예제 제공
   - 풍부한 문서

5. **비용**:
   - 완전 무료 (Apache 2.0 라이선스)
   - 상업적 사용 가능

#### 구현 우선순위:

**Phase 1: 기본 차트** (1-2일)
- 캔들스틱 차트 구현
- 시작일~종료일 데이터 표시

**Phase 2: 기술적 지표** (2-3일)
- 이동평균선 (MA20, MA50)
- RSI 서브차트
- 볼린저 밴드

**Phase 3: 백테스팅 통합** (2-3일)
- 매수/매도 마커 표시
- 수익 곡선 오버레이
- 인터랙티브 기능

---

## 📐 구현 상세 설계

### 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                         Frontend (Next.js)                   │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  Backtest Form                                         │ │
│  │  - Symbol, Date Range, Strategy Selection             │ │
│  └────────────────────────────────────────────────────────┘ │
│                            ↓                                 │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  TradingView Lightweight Chart Component              │ │
│  │  - Candlestick Chart                                   │ │
│  │  - Technical Indicators (MA, RSI, BB)                  │ │
│  │  - Buy/Sell Markers                                    │ │
│  └────────────────────────────────────────────────────────┘ │
│                            ↓                                 │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  Backtest Results Table                                │ │
│  │  - Metrics (Return, Drawdown, Sharpe, etc.)            │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                            ↕ REST API
┌─────────────────────────────────────────────────────────────┐
│                       Backend (FastAPI)                      │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  GET /api/v1/market-data/chart                         │ │
│  │  - Fetch OHLCV data from database                      │ │
│  │  - Calculate technical indicators (TA-Lib)             │ │
│  │  - Return formatted data for chart                     │ │
│  └────────────────────────────────────────────────────────┘ │
│                            ↓                                 │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  POST /api/v1/backtests                                │ │
│  │  - Execute backtest                                    │ │
│  │  - Generate buy/sell signals                           │ │
│  │  - Calculate performance metrics                       │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────────┐
│                      Database (Supabase)                     │
│  - bt_market_data (OHLCV)                                   │
│  - bt_backtests (Results)                                   │
│  - bt_backtest_trades (Signals)                             │
└─────────────────────────────────────────────────────────────┘
```

### API 엔드포인트 설계

#### 1. Chart Data API

```python
GET /api/v1/market-data/chart?symbol={symbol}&start_date={start}&end_date={end}&indicators={ma,rsi,bb}

Response:
{
  "symbol": "AAPL",
  "timeframe": "1D",
  "data": [
    {
      "time": "2023-01-03",
      "open": 128.34,
      "high": 128.95,
      "low": 122.32,
      "close": 123.21,
      "volume": 112117500
    }
  ],
  "indicators": {
    "ma20": [null, null, ..., 125.5],
    "ma50": [null, null, ..., 127.3],
    "rsi": [null, null, ..., 65.2],
    "bb_upper": [...],
    "bb_middle": [...],
    "bb_lower": [...]
  }
}
```

#### 2. Backtest with Chart Data API

```python
POST /api/v1/backtests/with-chart

Request:
{
  "strategy_id": "uuid",
  "symbol": "AAPL",
  "start_date": "2023-01-01",
  "end_date": "2024-01-01",
  "initial_capital": 10000,
  "indicators": ["ma20", "ma50", "rsi"]
}

Response:
{
  "backtest_id": "uuid",
  "metrics": {...},
  "chart_data": {
    "candles": [...],
    "indicators": {...},
    "signals": [
      {
        "time": "2023-03-15",
        "type": "buy",
        "price": 145.2,
        "quantity": 68.9
      }
    ]
  }
}
```

### 프론트엔드 컴포넌트 구조

```typescript
components/
├── charts/
│   ├── TradingChart.tsx              // 메인 차트 컴포넌트
│   ├── CandlestickChart.tsx          // 캔들스틱 차트
│   ├── IndicatorChart.tsx            // 지표 서브차트
│   ├── VolumeChart.tsx               // 거래량 차트
│   └── hooks/
│       ├── useChartData.ts           // 차트 데이터 관리
│       └── useIndicators.ts          // 지표 데이터 관리
├── backtest/
│   ├── BacktestForm.tsx              // 백테스트 설정 폼
│   ├── BacktestResults.tsx           // 결과 표시
│   └── BacktestChart.tsx             // 백테스트 차트 통합
└── shared/
    └── ChartControls.tsx             // 차트 컨트롤 (줌, 팬 등)
```

### 백엔드 서비스 구조

```python
services/
├── technical_indicators.py
│   └── class TechnicalIndicatorCalculator:
│       ├── calculate_ma(data, period)
│       ├── calculate_rsi(data, period)
│       ├── calculate_bollinger_bands(data, period, std)
│       ├── calculate_macd(data)
│       └── calculate_all(data, indicators_config)
│
└── chart_data_service.py
    └── class ChartDataService:
        ├── get_chart_data(symbol, start, end)
        ├── add_indicators(data, indicators)
        └── format_for_lightweight_charts(data)
```

---

## 🛠️ 기술 스택

### Frontend
- **차트 라이브러리**: `lightweight-charts` (^4.1.0)
- **React 통합**: Custom hooks
- **상태 관리**: React hooks (useState, useEffect)
- **API 통신**: fetch / axios

### Backend
- **기술 지표**: `TA-Lib` (Python)
- **데이터 처리**: `pandas`, `numpy`
- **대안 라이브러리**: `pandas-ta` (TA-Lib 설치 어려울 경우)

### 패키지 설치

```bash
# Frontend
npm install lightweight-charts

# Backend
pip install TA-Lib  # 또는 pandas-ta
```

---

## 📅 개발 로드맵

### Phase 1: 기본 차트 구현 (1-2일)

**목표**: 캔들스틱 차트 표시

**작업**:
1. ✅ lightweight-charts 패키지 설치
2. ✅ TradingChart 컴포넌트 생성
3. ✅ API 엔드포인트 구현 (`/api/v1/market-data/chart`)
4. ✅ 차트 데이터 바인딩
5. ✅ 기본 인터랙션 (줌, 팬)

**결과물**:
- 선택한 기간의 캔들스틱 차트 표시
- 마우스 드래그로 줌/팬 가능

---

### Phase 2: 기술적 지표 추가 (2-3일)

**목표**: 주요 지표 오버레이

**작업**:
1. ✅ TA-Lib 설치 및 설정
2. ✅ 지표 계산 서비스 구현
   - 이동평균 (MA20, MA50, MA200)
   - RSI (14)
   - 볼린저 밴드 (20, 2)
3. ✅ 서브차트 컴포넌트 구현
4. ✅ 지표 토글 UI
5. ✅ 지표 커스터마이징 옵션

**결과물**:
- 차트에 이동평균선 표시
- RSI 서브차트
- 볼린저 밴드 오버레이
- 사용자가 지표 선택 가능

---

### Phase 3: 백테스팅 통합 (2-3일)

**목표**: 백테스트 결과를 차트에 표시

**작업**:
1. ✅ 매수/매도 시그널 마커 추가
2. ✅ 수익 곡선 오버레이
3. ✅ 포지션 하이라이트
4. ✅ 인터랙티브 툴팁 (거래 정보)
5. ✅ 성과 메트릭 실시간 표시

**결과물**:
- 차트에 매수/매도 시점 표시
- 보유 기간 구간 하이라이트
- 마우스 오버 시 거래 상세 정보
- 실시간 수익률 계산

---

### Phase 4: 고급 기능 (선택, 3-5일)

**목표**: 전문가용 기능

**작업**:
1. ⬜ 멀티 타임프레임 (1H, 4H, 1D, 1W)
2. ⬜ 비교 차트 (여러 전략 비교)
3. ⬜ 차트 패턴 인식
4. ⬜ 알림/주석 기능
5. ⬜ 차트 이미지 export

**결과물**:
- 타임프레임 전환
- 여러 백테스트 결과 비교
- 자동 패턴 감지
- PNG/PDF 내보내기

---

## 💰 비용 및 리소스

### 라이브러리 라이선스
- **lightweight-charts**: Apache 2.0 (무료, 상업적 사용 가능)
- **TA-Lib**: BSD (무료, 오픈소스)
- **pandas-ta**: MIT (무료, 오픈소스)

### 개발 시간 예상
- **Phase 1**: 1-2일 (16시간)
- **Phase 2**: 2-3일 (24시간)
- **Phase 3**: 2-3일 (24시간)
- **Total**: 5-8일 (64시간)

### 추가 리소스
- 없음 (모두 오픈소스)

---

## 🎨 UI/UX 디자인

### 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│  백테스팅 설정                                               │
│  [전략 선택] [심볼] [시작일] [종료일] [자본] [실행]          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  차트 컨트롤                                                 │
│  [지표: MA20 ✓ MA50 ✓ RSI ✓ BB ✓] [타임프레임: 1D ▼]        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                                                               │
│                    캔들스틱 차트                              │
│                  + 이동평균선 (MA20, MA50)                   │
│                  + 볼린저 밴드                                │
│                  + 매수/매도 마커                             │
│                                                               │
│                         200                                   │
│                         150                                   │
│                         100                                   │
│                          50                                   │
│    Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                     RSI (14)                                 │
│    70 ─────────────────────────────────────── Overbought    │
│    50 ───────────────────────────────────────               │
│    30 ─────────────────────────────────────── Oversold      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                     거래량                                    │
│    ▂▃▅▇▅▃▂▃▅▇▅▃▂▃▅▇▅▃▂▃▅▇▅▃                                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  백테스트 결과                                               │
│  수익률: +2.48%  | 최대낙폭: -2.68% | 샤프비율: 0.62        │
│  총 거래: 1      | 승률: 0%         | 평균 수익: +2.48%     │
└─────────────────────────────────────────────────────────────┘
```

### 색상 스키마

```typescript
const chartColors = {
  candle: {
    up: '#26a69a',      // 상승 (초록)
    down: '#ef5350',    // 하락 (빨강)
    wick: {
      up: '#26a69a',
      down: '#ef5350'
    }
  },
  indicators: {
    ma20: '#2196F3',    // 파랑
    ma50: '#FF9800',    // 주황
    ma200: '#9C27B0',   // 보라
    rsi: '#00BCD4',     // 청록
    bb: '#FFC107'       // 노랑
  },
  signals: {
    buy: '#4CAF50',     // 녹색
    sell: '#F44336'     // 적색
  },
  background: '#ffffff',
  grid: '#f0f0f0',
  text: '#333333'
}
```

---

## 🧪 테스트 계획

### 단위 테스트
- 지표 계산 정확성
- 차트 데이터 포맷팅
- API 응답 검증

### 통합 테스트
- 백테스트 + 차트 통합
- 실시간 데이터 업데이트
- 에러 핸들링

### 성능 테스트
- 10,000+ 캔들 로딩 시간
- 지표 계산 속도
- 차트 렌더링 FPS

### 브라우저 호환성
- Chrome ✓
- Firefox ✓
- Safari ✓
- Edge ✓

---

## 📚 참고 자료

### 공식 문서
- [TradingView Lightweight Charts](https://tradingview.github.io/lightweight-charts/)
- [TA-Lib Documentation](https://ta-lib.org/function.html)
- [React Lightweight Charts Example](https://tradingview.github.io/lightweight-charts/tutorials/react/simple)

### GitHub 저장소
- [lightweight-charts](https://github.com/tradingview/lightweight-charts)
- [TA-Lib Python](https://github.com/mrjbq7/ta-lib)
- [pandas-ta](https://github.com/twopirllc/pandas-ta)

### Reddit 스레드
- r/algotrading: "Best charting library for backtesting"
- r/reactjs: "TradingView vs Recharts performance"
- r/datascience: "Technical indicators visualization"

---

## 🚀 다음 단계

1. ✅ **문서 검토 및 승인**
2. ⬜ **Phase 1 개발 시작**
   - lightweight-charts 설치
   - 기본 차트 컴포넌트 구현
3. ⬜ **Phase 2 개발**
   - TA-Lib 통합
   - 기술적 지표 추가
4. ⬜ **Phase 3 개발**
   - 백테스팅 통합
   - 시그널 마커 추가
5. ⬜ **테스트 및 최적화**
6. ⬜ **배포**

---

## 📞 지원 및 문의

- GitHub Issues: [trading-backtester](https://github.com/wjb127/trading-backtester/issues)
- 문서 업데이트: 구현 중 발견된 이슈 및 해결 방안 추가

---

**문서 버전 이력**

| 버전 | 날짜 | 변경사항 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-11-15 | 초안 작성 | Claude Code |

